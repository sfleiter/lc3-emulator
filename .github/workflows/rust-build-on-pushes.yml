name: Build (main) - on pushes
env:
  CARGO_TERM_COLOR: always
permissions:
  contents: read
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
jobs:
  verify-conventional-commits:
    name: Verify commits match conventional commits as configured in cliff.toml
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - name: Run git cliff
        uses: orhun/git-cliff-action@v4
        id: git-cliff
        with:
          config: cliff.toml
          args: -- ${{ github.sha }}..${{ github.sha }}
        env:
          OUTPUT: '-'
      - name: Echo commit log
        env:
          CHANGELOG: ${{ steps.git-cliff.outputs.content }}
        run: |
          echo Conventional commits as generated by git-cliff:
          echo $CHANGELOG
  call-rust-build-workflow_call:
    uses: ./.github/workflows/rust-build-workflow_call.yml
    with:
      build-profile: 'dev'
      oses: '[ "ubuntu-latest" ]'
